<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>음성통역 학습 사이트 - 테스트</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: "Noto Sans KR", system-ui, -apple-system, sans-serif;
      background: #111827;
      color: #e5e7eb;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      padding: 0.75rem 1.25rem;
      background: #020617;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
      border-bottom: 1px solid #1f2937;
    }
    header h1 {
      font-size: 1rem;
      margin: 0;
    }
    header .meta {
      font-size: 0.85rem;
      opacity: 0.8;
    }
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      padding: 1rem;
    }
    .player-area {
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2fr);
      gap: 1rem;
      align-items: stretch;
    }
    @media (max-width: 900px) {
      .player-area {
        grid-template-columns: minmax(0, 1fr);
      }
    }
    .video-card {
      background: #020617;
      border-radius: 0.75rem;
      padding: 0.75rem;
      box-shadow: 0 10px 25px rgba(0,0,0,0.4);
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    video {
      width: 100%;
      border-radius: 0.75rem;
      background: #000;
      max-height: 60vh;
    }
    .controls-top,
    .controls-bottom {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      align-items: center;
      justify-content: space-between;
      font-size: 0.85rem;
    }
    .btn {
      border: 1px solid #374151;
      background: #111827;
      color: #e5e7eb;
      border-radius: 999px;
      padding: 0.3rem 0.7rem;
      font-size: 0.8rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      transition: background 0.15s, border-color 0.15s, transform 0.08s;
      user-select: none;
    }
    .btn:hover {
      background: #1f2937;
      border-color: #4b5563;
      transform: translateY(-1px);
    }
    .btn:active {
      transform: translateY(0);
      background: #030712;
    }
    .btn-primary {
      background: #2563eb;
      border-color: #3b82f6;
    }
    .btn-primary:hover {
      background: #1d4ed8;
      border-color: #60a5fa;
    }
    .chip {
      border-radius: 999px;
      padding: 0.2rem 0.6rem;
      font-size: 0.75rem;
      background: #0b1120;
      border: 1px solid #1f2937;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
    }
    .chip-dot {
      width: 0.5rem;
      height: 0.5rem;
      border-radius: 999px;
      background: #4b5563;
    }
    .chip-dot.on {
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34,197,94,0.15);
    }
    .info-card {
      background: #020617;
      border-radius: 0.75rem;
      padding: 0.75rem 0.9rem;
      box-shadow: 0 10px 25px rgba(0,0,0,0.35);
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
      font-size: 0.9rem;
    }
    .label {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #9ca3af;
    }
    .answer-box {
      background: #020617;
      border-radius: 0.6rem;
      border: 1px dashed #374151;
      padding: 0.6rem 0.7rem;
      margin-top: 0.3rem;
    }
    .answer-line {
      margin-top: 0.3rem;
    }
    .answer-line strong {
      color: #e5e7eb;
    }
    .hidden {
      display: none;
    }
    .kbd-hint {
      font-size: 0.75rem;
      color: #9ca3af;
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem 0.6rem;
    }
    .kbd {
      border-radius: 0.35rem;
      border: 1px solid #4b5563;
      padding: 0.05rem 0.3rem;
      font-size: 0.7rem;
      background: #020617;
      color: #e5e7eb;
    }
    .list-card {
      margin-top: 0.5rem;
      background: #020617;
      border-radius: 0.6rem;
      border: 1px solid #111827;
      max-height: 220px;
      overflow: auto;
    }
    .list-item {
      display: flex;
      justify-content: space-between;
      padding: 0.35rem 0.6rem;
      font-size: 0.8rem;
      border-bottom: 1px solid #020617;
      cursor: pointer;
    }
    .list-item:last-child {
      border-bottom: none;
    }
    .list-item.active {
      background: #1f2937;
    }
    .list-item span.idx {
      opacity: 0.6;
      margin-right: 0.3rem;
    }
    footer {
      padding: 0.5rem 1rem;
      font-size: 0.7rem;
      color: #9ca3af;
      border-top: 1px solid #1f2937;
      background: #020617;
      display: flex;
      justify-content: space-between;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
  </style>
</head>
<body>
  <header>
    <h1>음성통역 학습 · 테스트(보다 / 가져오다)</h1>
    <div class="meta">
      GitHub에 올려서 사용 가능 · 단축키: <span class="kbd">?</span> 도움말 참고
    </div>
  </header>

  <main>
    <div class="player-area">
      <!-- 왼쪽: 비디오 -->
      <section class="video-card">
        <div class="controls-top">
          <div>
            <span class="label">현재 영상</span><br />
            <strong id="clipTitle">–</strong>
            <span id="clipMeta" style="font-size:0.8rem; opacity:0.75;"></span>
          </div>
          <div style="display:flex; gap:0.4rem; align-items:center; flex-wrap:wrap;">
            <button class="btn" id="prevBtn">← 이전(Left)</button>
            <button class="btn btn-primary" id="nextBtn">다음(Right) →</button>
            <button class="btn" id="togglePlayBtn">▶ / ⏸</button>
          </div>
        </div>

        <video id="video" controls playsinline preload="metadata">
          <!-- webm 파일은 같은 폴더에 넣어두면 됨 -->
        </video>

        <div class="controls-bottom">
          <div style="display:flex; gap:0.4rem; align-items:center; flex-wrap:wrap;">
            <button class="btn" id="slowerBtn">느리게(↓)</button>
            <button class="btn" id="fasterBtn">빠르게(↑)</button>
            <button class="btn" id="backwardBtn">⏪ 5초([)</button>
            <button class="btn" id="forwardBtn">⏩ 5초(])</button>
            <button class="btn" id="fullscreenBtn">전체화면(F)</button>
          </div>
          <div style="display:flex; gap:0.4rem; align-items:center;">
            <button class="btn" id="randomBtn">랜덤(R)</button>
            <span class="chip">
              <span id="randomDot" class="chip-dot"></span>
              <span id="randomText">순차 재생</span>
            </span>
          </div>
        </div>
      </section>

      <!-- 오른쪽: 정답 / 리스트 / 단축키 안내 -->
      <section class="info-card">
        <div>
          <div class="label">정답 확인</div>
          <button class="btn btn-primary" id="toggleAnswerBtn">정답 보기 / 숨기기 (Enter)</button>
          <div class="answer-box hidden" id="answerBox">
            <div class="answer-line">
              <strong>표제어:</strong> <span id="answerHeadword">–</span>
            </div>
            <div class="answer-line">
              <strong>용례:</strong>
              <div id="answerSentence" style="margin-top:0.2rem;"></div>
            </div>
          </div>
        </div>

        <div>
          <div class="label">목록</div>
          <div class="list-card" id="listContainer">
            <!-- JS로 목록 생성 -->
          </div>
        </div>

        <div>
          <div class="label">단축키 안내</div>
          <div class="kbd-hint">
            <span><span class="kbd">Space</span> 재생/일시정지</span>
            <span><span class="kbd">← / →</span> 이전 / 다음</span>
            <span><span class="kbd">↑ / ↓</span> 속도 조절</span>
            <span><span class="kbd">[ / ]</span> -5초 / +5초</span>
            <span><span class="kbd">F</span> 전체화면</span>
            <span><span class="kbd">R</span> 랜덤 토글 + 순서 섞기</span>
            <span><span class="kbd">0~9</span> 해당 % 위치로 점프</span>
            <span><span class="kbd">Enter</span> 정답 보기/숨기기</span>
          </div>
        </div>
      </section>
    </div>
  </main>

  <footer>
    <div>테스트 데이터: 「보다」 5문장, 「가져오다」 2문장</div>
    <div>영상 파일(.webm)은 이 HTML 파일과 같은 폴더에 두면 됩니다.</div>
  </footer>

  <script>
    // ===== 1. 데이터 정의 =====
    // 실제로는 여기만 교체해서 확장하면 됨
    const clipsOriginal = [
      {
        id: "1-1",
        headword: "보다",
        sentence: "1) 내가 담근 김치가 사 먹는 김치보다 맛있다.",
        file: "1-1.webm",
      },
      {
        id: "1-2",
        headword: "보다",
        sentence: "2) 나는 상대방보다 언변이 더 좋다.",
        file: "1-2.webm",
      },
      {
        id: "1-3",
        headword: "보다",
        sentence: "3) 소형 선풍기보다 대형 선풍기가 바람이 더 세다.",
        file: "1-3.webm",
      },
      {
        id: "1-4",
        headword: "보다",
        sentence: "4) 청력검사 결과 나는 오른쪽 귀의 청력이 더 좋다.",
        file: "1-4.webm",
      },
      {
        id: "1-5",
        headword: "보다",
        sentence: "5) 언니가 나보다 요리 솜씨가 더 뛰어나다.",
        file: "1-5.webm",
      },
      {
        id: "2-1",
        headword: "가져오다",
        sentence: "1) 따뜻한 물을 가져다주세요.",
        file: "2-1.webm",
      },
      {
        id: "2-2",
        headword: "가져오다",
        sentence: "2) 회의록을 저에게 가지고 오세요.",
        file: "2-2.webm",
      },
    ];

    // 실제 재생에 사용하는 배열 (순차/랜덤 모두 여기에 반영)
    let clipsCurrent = [...clipsOriginal];
    let currentIndex = 0;
    let isRandom = false;

    // ===== 2. DOM 요소 =====
    const videoEl = document.getElementById("video");
    const clipTitleEl = document.getElementById("clipTitle");
    const clipMetaEl = document.getElementById("clipMeta");
    const answerBoxEl = document.getElementById("answerBox");
    const answerHeadwordEl = document.getElementById("answerHeadword");
    const answerSentenceEl = document.getElementById("answerSentence");
    const listContainerEl = document.getElementById("listContainer");

    const randomDotEl = document.getElementById("randomDot");
    const randomTextEl = document.getElementById("randomText");

    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const togglePlayBtn = document.getElementById("togglePlayBtn");
    const slowerBtn = document.getElementById("slowerBtn");
    const fasterBtn = document.getElementById("fasterBtn");
    const backwardBtn = document.getElementById("backwardBtn");
    const forwardBtn = document.getElementById("forwardBtn");
    const fullscreenBtn = document.getElementById("fullscreenBtn");
    const randomBtn = document.getElementById("randomBtn");
    const toggleAnswerBtn = document.getElementById("toggleAnswerBtn");

    // ===== 3. 도우미 함수들 =====

    // Fisher–Yates Shuffle
    function shuffleArray(array) {
      const arr = [...array];
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function loadClip(index, { autoplay = true } = {}) {
      if (index < 0 || index >= clipsCurrent.length) return;
      currentIndex = index;
      const clip = clipsCurrent[currentIndex];

      videoEl.src = clip.file;
      // autoplay는 사용자가 이미 상호작용한 후에만 제대로 동작할 수 있음(브라우저 정책)
      if (autoplay) {
        videoEl.play().catch(() => {});
      }

      clipTitleEl.textContent = `${clip.headword}`;
      clipMetaEl.textContent = ` · ${clip.sentence.replace(/^\d+\)\s*/, "")} (파일: ${clip.file})`;

      // 정답 영역 업데이트(보이지만 않을 수 있음)
      answerHeadwordEl.textContent = clip.headword;
      answerSentenceEl.textContent = clip.sentence;

      // 목록 active 표시
      updateListActive();
    }

    function updateListActive() {
      const items = listContainerEl.querySelectorAll(".list-item");
      items.forEach((item, idx) => {
        if (idx === currentIndex) {
          item.classList.add("active");
        } else {
          item.classList.remove("active");
        }
      });
    }

    function toggleAnswer() {
      answerBoxEl.classList.toggle("hidden");
    }

    function updateRandomUI() {
      if (isRandom) {
        randomDotEl.classList.add("on");
        randomTextEl.textContent = "랜덤 재생";
      } else {
        randomDotEl.classList.remove("on");
        randomTextEl.textContent = "순차 재생";
      }
    }

    function toggleRandomMode() {
      isRandom = !isRandom;

      if (isRandom) {
        // 랜덤 모드 켜질 때: 원본을 섞어서 clipsCurrent에 저장
        clipsCurrent = shuffleArray(clipsOriginal);
        // 새 순서 기준으로 0번부터 시작
        currentIndex = 0;
      } else {
        // 랜덤 모드 끄면: 원래 순서로 복원
        clipsCurrent = [...clipsOriginal];
        currentIndex = 0;
      }

      // UI 반영
      updateRandomUI();
      buildList();      // 목록도 새 순서대로 다시 그림
      loadClip(currentIndex, { autoplay: false }); // 현재 인덱스 클립 로드
    }

    function nextClip() {
      const nextIndex = (currentIndex + 1) % clipsCurrent.length;
      loadClip(nextIndex);
    }

    function prevClip() {
      const prevIndex = (currentIndex - 1 + clipsCurrent.length) % clipsCurrent.length;
      loadClip(prevIndex);
    }

    function changeSpeed(delta) {
      let newRate = videoEl.playbackRate + delta;
      if (newRate < 0.25) newRate = 0.25;
      if (newRate > 3) newRate = 3;
      videoEl.playbackRate = newRate;
    }

    function seekRelative(seconds) {
      videoEl.currentTime = Math.max(0, videoEl.currentTime + seconds);
    }

    function togglePlay() {
      if (videoEl.paused) {
        videoEl.play().catch(() => {});
      } else {
        videoEl.pause();
      }
    }

    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        videoEl.requestFullscreen?.();
      } else {
        document.exitFullscreen?.();
      }
    }

    function seekPercent(percent) {
      if (!videoEl.duration || isNaN(videoEl.duration)) return;
      videoEl.currentTime = videoEl.duration * percent;
    }

    // ===== 4. 목록 생성 =====
    function buildList() {
      listContainerEl.innerHTML = "";
      clipsCurrent.forEach((clip, idx) => {
        const div = document.createElement("div");
        div.className = "list-item";
        div.innerHTML = `
          <div>
            <span class="idx">${idx + 1}.</span>
            <strong>${clip.headword}</strong>
            <span style="opacity:0.7;">${clip.sentence.replace(/^\d+\)\s*/, "")}</span>
          </div>
          <div style="opacity:0.6; font-size:0.75rem;">${clip.file}</div>
        `;
        div.addEventListener("click", () => {
          loadClip(idx);
        });
        listContainerEl.appendChild(div);
      });
      updateListActive();
    }

    // ===== 5. 이벤트 연결 =====
    prevBtn.addEventListener("click", prevClip);
    nextBtn.addEventListener("click", nextClip);
    togglePlayBtn.addEventListener("click", togglePlay);
    slowerBtn.addEventListener("click", () => changeSpeed(-0.25));
    fasterBtn.addEventListener("click", () => changeSpeed(0.25));
    backwardBtn.addEventListener("click", () => seekRelative(-5));
    forwardBtn.addEventListener("click", () => seekRelative(5));
    fullscreenBtn.addEventListener("click", toggleFullscreen);
    randomBtn.addEventListener("click", toggleRandomMode);
    toggleAnswerBtn.addEventListener("click", toggleAnswer);

    // 비디오 끝났을 때 자동으로 다음 클립
    videoEl.addEventListener("ended", nextClip);

    // 키보드 단축키
    document.addEventListener("keydown", (e) => {
      const tag = e.target.tagName.toLowerCase();
      // 입력창 포커스 있을 때(추후 텍스트 입력 기능 추가 대비) 키 막기
      if (tag === "input" || tag === "textarea") return;

      switch (e.key) {
        case " ":
          e.preventDefault();
          togglePlay();
          break;
        case "ArrowRight":
          e.preventDefault();
          nextClip();
          break;
        case "ArrowLeft":
          e.preventDefault();
          prevClip();
          break;
        case "ArrowUp":
          e.preventDefault();
          changeSpeed(0.25);
          break;
        case "ArrowDown":
          e.preventDefault();
          changeSpeed(-0.25);
          break;
        case "[":
          seekRelative(-5);
          break;
        case "]":
          seekRelative(5);
          break;
        case "f":
        case "F":
          toggleFullscreen();
          break;
        case "r":
        case "R":
          toggleRandomMode();
          break;
        case "Enter":
          toggleAnswer();
          break;
        default:
          // 숫자 0~9 퍼센트 점프
          if (e.key >= "0" && e.key <= "9") {
            const num = parseInt(e.key, 10);
            seekPercent(num === 0 ? 0 : num / 10);
          }
      }
    });

    // ===== 6. 초기화 =====
    function init() {
      updateRandomUI();
      buildList();
      loadClip(0, { autoplay: false });
    }

    init();
  </script>
</body>
</html>
